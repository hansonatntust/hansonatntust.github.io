<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>狐狸與獵人</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 導入字體 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        html, body { 
            height: 100%; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0; 
            padding: 0 0 2em 0; 
            min-height: 100vh;
            position: relative;
        }
        
        /* 背景動畫粒子效果 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="60" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2em 2vw;
            position: relative;
            z-index: 1;
        }
        
        h2 { 
            font-size: 2.5em; 
            margin: 0.5em 0 1em 0; 
            text-align: center; 
            letter-spacing: 2px; 
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            font-weight: 700;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* 按鈕樣式優化 */
        button { 
            font-size: 1.2em; 
            font-weight: 500;
            padding: 0.8em 2em; 
            margin: 0.5em; 
            border-radius: 25px; 
            border: none; 
            background: linear-gradient(45deg, #ff6b9d, #c44569);
            color: #fff; 
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.6);
        }
        
        button:active { 
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(255, 107, 157, 0.4);
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 1em;
            margin-bottom: 2em;
            flex-wrap: wrap;
        }
        
        #visual { 
            margin-bottom: 2.5em; 
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5em;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        #desc { 
            background: rgba(255,255,255,0.95);
            color: #333; 
            padding: 1.2em 1.5em; 
            margin: 2em auto 1em auto; 
            border-radius: 15px; 
            min-height: 3em; 
            font-size: 1.1em; 
            border: none;
            max-width: 500px; 
            box-sizing: border-box; 
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            line-height: 1.6;
            font-weight: 400;
        }
        
        .holes-row { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 1.5em; 
            margin: 1em 0;
        }
        
        .holes-num-row {
            display: flex;
            justify-content: center;
            gap: 1.5em;
            margin-bottom: 0.5em;
        }
        
        .holes-num-row > div {
            width: 60px !important;
            max-width: 60px !important;
            min-width: 60px !important;
            text-align: center;
            font-size: 1.1em !important;
            color: rgba(255,255,255,0.8) !important;
            font-weight: 500;
        }
        
        .hole { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            width: 60px;
            height: 60px;
            margin: 2px; 
            text-align: center; 
            font-size: 2.2em; 
            border-radius: 50%; 
            border: 3px solid rgba(255,255,255,0.3);
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            box-sizing: border-box; 
            transition: all 0.4s ease;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
        }
        
        .hole::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .hole:hover::before {
            opacity: 1;
            animation: shimmer 1s ease-in-out;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        /* 特殊狀態樣式 */
        .hole.fox-hole {
            background: linear-gradient(145deg, #ffe082, #ffcc02) !important;
            border-color: #ff8f00 !important;
            box-shadow: 
                0 6px 20px rgba(255, 193, 7, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.8) !important;
            animation: foxGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes foxGlow {
            0% { box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4), inset 0 1px 0 rgba(255,255,255,0.8); }
            100% { box-shadow: 0 8px 25px rgba(255, 193, 7, 0.6), inset 0 1px 0 rgba(255,255,255,0.8); }
        }
        
        .hole.hunter-hole {
            background: linear-gradient(145deg, #b3e5fc, #81d4fa) !important;
            border-color: #0288d1 !important;
            box-shadow: 
                0 6px 20px rgba(3, 169, 244, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.8) !important;
        }
        
        .hole.caught-hole {
            background: linear-gradient(145deg, #ffecb3, #ffe082) !important;
            border-color: #e65100 !important;
            box-shadow: 
                0 8px 25px rgba(230, 81, 0, 0.5),
                inset 0 1px 0 rgba(255,255,255,0.8) !important;
            animation: caughtPulse 0.5s ease-in-out 3;
        }
        
        @keyframes caughtPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* 響應式設計 */
        @media (max-width: 900px) {
            .container { max-width: 98vw; padding: 1.5em 2vw; }
            h2 { font-size: 2em; }
            #desc { font-size: 1em; }
            .hole { width: 50px; height: 50px; font-size: 1.8em; }
            .holes-num-row > div { width: 50px !important; max-width: 50px !important; min-width: 50px !important; }
        }
        
        @media (max-width: 600px) {
            .container { max-width: 100vw; padding: 1em 1vw; }
            h2 { font-size: 1.6em; }
            #desc { font-size: 0.95em; padding: 1em; margin-top: 1.5em; }
            .hole { width: 45px; height: 45px; font-size: 1.6em; }
            .holes-num-row > div { width: 45px !important; max-width: 45px !important; min-width: 45px !important; }
            .holes-row { gap: 1em; }
            .holes-num-row { gap: 1em; }
            button { font-size: 1em; padding: 0.7em 1.5em; }
        }
        
        @media (max-width: 400px) {
            .hole { width: 40px; height: 40px; font-size: 1.4em; }
            .holes-num-row > div { width: 40px !important; max-width: 40px !important; min-width: 40px !important; }
        }
        
        button:disabled {
            background: linear-gradient(45deg, #ccc, #999) !important;
            color: #666 !important;
            cursor: not-allowed !important;
            opacity: 0.6;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* 控制按鈕樣式 */
        #catchControls {
            display: none;
            justify-content: center;
            gap: 0.8em;
            margin-top: 1.5em;
            flex-wrap: wrap;
        }
        
        #catchControls button {
            min-width: 3em;
            padding: 0.6em 1em;
            font-size: 1.1em;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            margin: 0.2em;
        }
        
        #catchControls button:hover {
            background: linear-gradient(45deg, #45a049, #3d8b40);
        }
        
        /* 載入動畫 */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* 成功動畫 */
        @keyframes successBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .success-animation {
            animation: successBounce 1s ease-in-out;
        }
        
        /* 彈框樣式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 2em;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideIn 0.4s ease-out;
            margin: 1em;
        }
        
        @keyframes slideIn {
            from { 
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 1.5em;
        }
        
        .modal-title {
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b9d, #4285f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5em;
        }
        
        .modal-subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .modal-body {
            color: #333;
            line-height: 1.8;
            font-size: 1em;
        }
        
        .modal-footer {
            text-align: center;
            margin-top: 2em;
            padding-top: 1.5em;
            border-top: 1px solid #eee;
        }
        
        .modal-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 1em 3em;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }
        
        /* 響應式彈框 */
        @media (max-width: 600px) {
            .modal-content {
                margin: 0.5em;
                padding: 1.5em;
                max-height: 90vh;
            }
            
            .modal-title {
                font-size: 1.6em;
            }
            
            .modal-body {
                font-size: 0.95em;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>🦊 狐狸與獵人 🎯</h2>
        <div class="button-container">
            <button id="simBtn" onclick="startSimulation()">
                <i class="fas fa-play"></i> 模擬模式
            </button>
            <button id="catchBtn" onclick="startCatchMode()">
                <i class="fas fa-crosshairs"></i> 抓狐狸遊戲
            </button>
        </div>
        <div id="visual"></div>
        <div id="desc">
            <h3 style="text-align: center; color: #ff6b9d; margin-bottom: 1em; font-size: 1.2em;">
                <i class="fas fa-book-open"></i> 遊戲規則
            </h3>
            <div style="text-align: left; font-size: 0.95em;">
                <p><strong>🎯 目標：</strong>抓住藏在5個洞穴中的狐狸</p>
                <p><strong>🦊 狐狸規則：</strong>每晚必須移動到相鄰洞穴，不能停留原地</p>
                <p><strong>🎯 獵人規則：</strong>每天只能檢查一個洞穴</p>
                <p><strong>🧠 挑戰：</strong>設計策略保證能抓到狐狸！</p>
                <div style="text-align: center; margin-top: 1.5em; padding-top: 1em; border-top: 1px solid #eee;">
                    <em style="color: #666;">選擇模式開始遊戲 ↑</em>
                </div>
            </div>
        </div>
        <div id="catchControls"></div>
    </div>


    <script>

    // 狐狸類別：負責狐狸的位置與移動
    class Fox {
        constructor(startingPosition) {
            this.currentPosition = startingPosition; // 狐狸目前所在洞口
        }

        // 狐狸每晚必須移動到相鄰的洞口
        move() {
            const pos = this.currentPosition;
            let options = [];
            if (pos === 1) {
                options = [2]; // 洞1只能移到洞2
            } else if (pos === 5) {
                options = [4]; // 洞5只能移到洞4
            } else {
                options = [pos - 1, pos + 1]; // 其他洞可往左或右
            }
            // 隨機選擇一個可移動的洞口
            this.currentPosition = options[Math.floor(Math.random() * options.length)];
        }
    }

    // 獵人類別：負責獵人的查找策略
    class Hunter {
        constructor(strategy) {
            this.strategy = strategy; // 查找洞口的順序陣列
        }

        // 回傳指定天數要查的洞口（1-based）
        getCheck(day) {
            return this.strategy[day - 1];
        }
    }

    // 畫出當前洞口狀態

function drawHoles(foxPos, hunterPos, day, isNight, caught) {
    // 先產生數字列
    let numRow = '<div class="holes-num-row">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div>${i}</div>`;
    }
    numRow += '</div>';
    
    // 洞口圖示
    const holeIcons = [];
    for (let i = 1; i <= 5; i++) {
        let classes = ['hole'];
        let foxHere = i === foxPos;
        let hunterHere = i === hunterPos && !isNight;
        let content = '';
        
        // 根據狀態添加CSS類別
        if (foxHere && hunterHere && caught) {
            classes.push('caught-hole');
            content = '<span style="font-size:1.8em;">💥</span>';
        } else if (foxHere && hunterHere) {
            classes.push('fox-hole');
            content = '<div style="display:flex;align-items:center;justify-content:center;gap:2px;"><span style="font-size:1.2em;">🦊</span><span style="font-size:1.2em;">🎯</span></div>';
        } else if (foxHere) {
            classes.push('fox-hole');
            content = '<span style="font-size:1.6em;">🦊</span>';
        } else if (hunterHere) {
            classes.push('hunter-hole');
            content = '<span style="font-size:1.6em;">🎯</span>';
        } else {
            content = isNight ? '<i class="fas fa-moon" style="font-size:0.8em;color:#666;"></i>' : '';
        }
        
        holeIcons.push(`<div class="${classes.join(' ')}">${content}</div>`);
    }
    
    const timeIndicator = isNight ? 
        '<div style="text-align:center;margin-bottom:1em;color:rgba(255,255,255,0.9);font-size:1.1em;"><i class="fas fa-moon"></i> 夜晚</div>' : 
        '<div style="text-align:center;margin-bottom:1em;color:rgba(255,255,255,0.9);font-size:1.1em;"><i class="fas fa-sun"></i> 白天</div>';
    
    document.getElementById('visual').innerHTML = timeIndicator + numRow + `<div class='holes-row'>${holeIcons.join('')}</div>`;
}

    // 模擬函式：執行一次遊戲流程，並回傳每一步狀態
    function runVisual(foxStartPosition, hunterStrategy) {
        const fox = new Fox(foxStartPosition);
        const hunter = new Hunter(hunterStrategy);
        const steps = [];
        for (let day = 1; day <= hunterStrategy.length; day++) {
            const checkHole = hunter.getCheck(day);
            steps.push({
                type: 'day',
                day,
                fox: fox.currentPosition,
                hunter: checkHole,
                caught: checkHole === fox.currentPosition
            });
            if (checkHole === fox.currentPosition) break;
            if (day < hunterStrategy.length) {
                fox.move();
                steps.push({
                    type: 'night',
                    day,
                    fox: fox.currentPosition,
                    hunter: null,
                    caught: false
                });
            }
        }
        return steps;
    }

    // 啟動模擬主流程（含圖像化）

let simState = { start: 1, hunterStrategy: [2, 3, 4, 4, 3, 2], steps: [], stepIdx: 0, running: false };

async function startSimulation() {
    simState = { start: 1, hunterStrategy: [2, 3, 4, 4, 3, 2], steps: [], stepIdx: 0, running: true };
    const visualDiv = document.getElementById('visual');
    const descDiv = document.getElementById('desc');
    const simBtn = document.getElementById('simBtn');
    const catchBtn = document.getElementById('catchBtn');
    
    visualDiv.innerHTML = '';
    descDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在準備模擬...';
    simBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 模擬中...';
    simBtn.disabled = true;
    catchBtn.innerHTML = '<i class="fas fa-crosshairs"></i> 抓狐狸遊戲';
    
    // 隱藏選洞按鈕
    document.getElementById('catchControls').style.display = 'none';
    document.getElementById('catchControls').innerHTML = '';
    
    await runOneSimulation();
    
    simBtn.innerHTML = '<i class="fas fa-play"></i> 模擬模式';
    simBtn.disabled = false;
    catchBtn.innerHTML = '<i class="fas fa-crosshairs"></i> 抓狐狸遊戲';
}

// 抓狐狸模式狀態
let catchState = null;
function startCatchMode() {
    // 狐狸隨機選一個洞
    catchState = {
        fox: new Fox(Math.floor(Math.random()*5)+1),
        hunterPos: null,
        day: 1,
        running: true,
        msg: ''
    };
    document.getElementById('desc').innerHTML = '<i class="fas fa-search"></i> 請選擇要檢查的洞口（1~5）：';
    document.getElementById('simBtn').innerHTML = '<i class="fas fa-play"></i> 模擬模式';
    document.getElementById('catchBtn').innerHTML = '<i class="fas fa-crosshairs"></i> 抓狐狸遊戲';
    drawCatchHoles();
    showCatchControls();
}
// 不再需要 showCatchStartSelector
// 不再需要 catchStart
function drawCatchHoles() {
    // 顯示獵人與狐狸，若抓到則顯示💥
    let numRow = '<div class="holes-num-row">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div>${i}</div>`;
    }
    numRow += '</div>';
    
    const holeIcons = [];
    let caught = catchState && !catchState.running && catchState.hunterPos === catchState.fox.currentPosition;
    
    for (let i = 1; i <= 5; i++) {
        let classes = ['hole'];
        let hunterHere = i === catchState.hunterPos;
        let foxHere = i === catchState.fox.currentPosition;
        let content = '';
        
        if (hunterHere && foxHere && caught) {
            classes.push('caught-hole');
            content = '<span style="font-size:1.8em;">💥</span>';
        } else if (hunterHere) {
            classes.push('hunter-hole');
            content = '<span style="font-size:1.6em;">🎯</span>';
        } else {
            content = '';
        }
        
        holeIcons.push(`<div class="${classes.join(' ')}">${content}</div>`);
    }
    
    const dayIndicator = `<div style="text-align:center;margin-bottom:1em;color:rgba(255,255,255,0.9);font-size:1.1em;"><i class="fas fa-calendar-day"></i> 第 ${catchState.day} 天</div>`;
    document.getElementById('visual').innerHTML = dayIndicator + numRow + `<div class='holes-row'>${holeIcons.join('')}</div>`;
}
function showCatchControls() {
    const controls = document.getElementById('catchControls');
    controls.style.display = 'flex';
    controls.innerHTML = '';
    // 顯示1~5數字按鈕
    for (let i = 1; i <= 5; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.style.minWidth = '2.5em';
        btn.onclick = () => checkHole(i);
        controls.appendChild(btn);
    }
}


function checkHole(holeNum) {
    if (!catchState.running) return;
    catchState.hunterPos = holeNum;
    // 禁用所有洞口按鈕
    const controls = document.getElementById('catchControls');
    Array.from(controls.querySelectorAll('button')).forEach(btn => btn.disabled = true);
    // 白天檢查
    if (catchState.hunterPos === catchState.fox.currentPosition) {
        catchState.running = false;
        drawCatchHolesCaught();
        document.getElementById('desc').innerHTML = `<i class="fas fa-trophy"></i> 恭喜！你在第${catchState.day}天於洞口${catchState.hunterPos}抓到狐狸！`;
        document.getElementById('catchControls').innerHTML = '<button onclick="resetAll()"><i class="fas fa-redo"></i> 再玩一次</button>';
    } else {
        document.getElementById('desc').innerHTML = `<i class="fas fa-times"></i> 第${catchState.day}天，沒抓到，夜晚狐狸移動...`;
        drawCatchHoles();
        setTimeout(()=>{
            catchState.fox.move();
            catchState.day++;
            document.getElementById('desc').innerHTML = `<i class="fas fa-search"></i> 第${catchState.day}天，請選擇要檢查的洞口。`;
            drawCatchHoles();
            // 換日後恢復按鈕可用
            Array.from(controls.querySelectorAll('button')).forEach(btn => btn.disabled = false);
        }, 700);
    }
}

function drawCatchHolesCaught() {
    // 顯示抓到圖示
    let numRow = '<div class="holes-num-row">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div>${i}</div>`;
    }
    numRow += '</div>';
    
    const holeIcons = [];
    for (let i = 1; i <= 5; i++) {
        let classes = ['hole'];
        let hunterHere = i === catchState.hunterPos;
        let content = '';
        
        if (hunterHere) {
            classes.push('caught-hole', 'success-animation');
            content = '<span style="font-size:1.8em;">💥</span>';
        } else {
            content = '';
        }
        
        holeIcons.push(`<div class="${classes.join(' ')}">${content}</div>`);
    }
    
    const successIndicator = `<div style="text-align:center;margin-bottom:1em;color:#4CAF50;font-size:1.2em;font-weight:bold;"><i class="fas fa-trophy"></i> 成功抓到狐狸！</div>`;
    document.getElementById('visual').innerHTML = successIndicator + numRow + `<div class='holes-row'>${holeIcons.join('')}</div>`;
}
function resetAll() {
    document.getElementById('catchControls').style.display = 'none';
    document.getElementById('catchControls').innerHTML = '';
    document.getElementById('desc').textContent = '';
    document.getElementById('visual').innerHTML = '';
    // 直接重新開始抓狐狸遊戲
    startCatchMode();
}
async function runOneSimulation() {
    const { start, hunterStrategy } = simState;
    const visualDiv = document.getElementById('visual');
    const descDiv = document.getElementById('desc');
    descDiv.textContent = '';
    visualDiv.innerHTML = '';
    simState.steps = runVisual(simState.start, hunterStrategy);
    simState.stepIdx = 0;
    for (let i = 0; i < simState.steps.length; i++) {
        simState.stepIdx = i;
        const s = simState.steps[i];
        // 傳入 caught 參數，只有抓到時才為 true
        drawHoles(s.fox, s.hunter, s.day, s.type === 'night', s.caught);
        // 文字說明
        let msg = '';
        if (s.type === 'day') {
            msg = `第${s.day}天：獵人檢查洞口${s.hunter}，狐狸在洞口${s.fox}。`;
            if (s.caught) msg += `\n在第${s.day}天於洞口${s.fox}抓到狐狸！成功！`;
        } else {
            msg = `夜晚${s.day}：狐狸移動到洞口${s.fox}。`;
        }
        descDiv.textContent = msg;
        if (s.caught) {
            await new Promise(r => setTimeout(r, 700));
            descDiv.textContent += '\n模擬結束';
            return;
        }
        await new Promise(r => setTimeout(r, 700));
    }
    descDiv.textContent += '\n模擬結束';
}
    </script>
</body>
</html>