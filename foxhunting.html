<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹ç‹¸èˆ‡æ´é‚è¼¯æ¨¡æ“¬</title>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 0 0 2em 0; }
        .container {
            max-width: 520px;
            margin: 0 auto;
            padding: 0 2vw;
        }
        h2 { font-size: 2em; margin: 1.2em 0 0.7em 0; text-align: center; letter-spacing: 1px; }
        button { font-size: 1.1em; padding: 0.5em 1.5em; margin: 1em auto; display: block; border-radius: 6px; border: none; background: #ffe082; color: #333; box-shadow: 0 1px 4px #0001; transition: background 0.2s; }
        button:active { background: #ffd54f; }
        #visual { margin-bottom: 2.5em; }
        #desc { background: #fffbe7; color: #333; padding: 0.7em 1em; margin: 2.2em auto 1em auto; border-radius: 6px; min-height: 2.5em; font-size: 1.1em; border: 1px solid #ffe082; max-width: 480px; box-sizing: border-box; transition: margin-top 0.2s; }
        .holes-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 2vw; }
        .hole { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 14vw; max-width: 56px; min-width: 36px; height: 14vw; max-height: 56px; min-height: 36px; margin: 2px; text-align: center; font-size: 2.1em; border-radius: 50%; border: 2px solid #888; vertical-align: middle; background: #fff; box-sizing: border-box; transition: background 0.2s, border 0.2s; }
        .hole .hole-num { font-size: 0.7em; color: #888; margin-top: -2px; }
        @media (max-width: 900px) {
            .container { max-width: 98vw; }
            h2 { font-size: 1.4em; }
            #desc { font-size: 1em; }
        }
        @media (max-width: 600px) {
            .container { max-width: 100vw; padding: 0 1vw; }
            h2 { font-size: 1.1em; }
            #desc { font-size: 0.98em; padding: 0.6em 0.5em; margin-top: 1.5em; }
            .hole { font-size: 7vw; min-width: 28px; min-height: 28px; max-width: 44px; max-height: 44px; }
        }
        @media (max-width: 400px) {
            .hole { font-size: 9vw; min-width: 20px; min-height: 20px; max-width: 32px; max-height: 32px; }
        }
        button:disabled {
            background: #eee !important;
            color: #aaa !important;
            cursor: not-allowed !important;
            opacity: 0.7;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>ç‹ç‹¸èˆ‡æ´é‚è¼¯æ¨¡æ“¬</h2>
        <div style="display:flex;justify-content:center;gap:1em;margin-bottom:1em;">
            <button id="simBtn" onclick="startSimulation()">æ¨¡æ“¬æ¨¡å¼</button>
            <button id="catchBtn" onclick="startCatchMode()">æŠ“ç‹ç‹¸éŠæˆ²</button>
        </div>
        <div id="visual" style="margin-bottom:0.5em;"></div>
        <div id="desc" style="background:#fffbe7;color:#333;padding:0.7em 1em;margin-bottom:1em;border-radius:6px;min-height:2.5em;font-size:1.1em;border:1px solid #ffe082;"></div>
        <div id="catchControls" style="display:none;justify-content:center;gap:1em;margin-top:1em;"></div>

    </div>


    <script>
    // ç‹ç‹¸é¡åˆ¥ï¼šè² è²¬ç‹ç‹¸çš„ä½ç½®èˆ‡ç§»å‹•
    class Fox {
        constructor(startingPosition) {
            this.currentPosition = startingPosition; // ç‹ç‹¸ç›®å‰æ‰€åœ¨æ´å£
        }

        // ç‹ç‹¸æ¯æ™šå¿…é ˆç§»å‹•åˆ°ç›¸é„°çš„æ´å£
        move() {
            const pos = this.currentPosition;
            let options = [];
            if (pos === 1) {
                options = [2]; // æ´1åªèƒ½ç§»åˆ°æ´2
            } else if (pos === 5) {
                options = [4]; // æ´5åªèƒ½ç§»åˆ°æ´4
            } else {
                options = [pos - 1, pos + 1]; // å…¶ä»–æ´å¯å¾€å·¦æˆ–å³
            }
            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹å¯ç§»å‹•çš„æ´å£
            this.currentPosition = options[Math.floor(Math.random() * options.length)];
        }
    }

    // çµäººé¡åˆ¥ï¼šè² è²¬çµäººçš„æŸ¥æ‰¾ç­–ç•¥
    class Hunter {
        constructor(strategy) {
            this.strategy = strategy; // æŸ¥æ‰¾æ´å£çš„é †åºé™£åˆ—
        }

        // å›å‚³æŒ‡å®šå¤©æ•¸è¦æŸ¥çš„æ´å£ï¼ˆ1-basedï¼‰
        getCheck(day) {
            return this.strategy[day - 1];
        }
    }

    // ç•«å‡ºç•¶å‰æ´å£ç‹€æ…‹

function drawHoles(foxPos, hunterPos, day, isNight, caught) {
    // å…ˆç”¢ç”Ÿæ•¸å­—åˆ—
    let numRow = '<div class="holes-num-row" style="display:flex;justify-content:center;gap:2vw;margin-bottom:2px;">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div style="width:14vw;max-width:56px;min-width:36px;text-align:center;font-size:1em;color:#888;">${i}</div>`;
    }
    numRow += '</div>';
    // æ´å£åœ–ç¤º
    const holeIcons = [];
    for (let i = 1; i <= 5; i++) {
        let style = 'hole';
        let extraStyle = '';
        let foxHere = i === foxPos;
        let hunterHere = i === hunterPos && !isNight;
        let content = '';
        // ç™½å¤©/å¤œæ™šåº•è‰²
        let baseBg = isNight ? '#e0e0e0' : '#fff';
        // æŠ“åˆ°æ™‚é¡¯ç¤ºç‰¹æ®Šåœ–
        if (foxHere && hunterHere && caught) {
            content = '<span style="font-size:1.5em;">ğŸ’¥</span>';
            extraStyle = 'background:#ffecb3;border:2px solid #e65100;';
        } else {
            // æ´å…§åŒæ™‚æœ‰ç‹ç‹¸å’Œçµäºº
            if (foxHere && hunterHere) {
                content = '<span style="font-size:1.3em;">ğŸ¦Š</span><span style="font-size:1.3em;">ğŸ¯</span>';
                extraStyle = 'background:#ffe082;';
            } else if (foxHere) {
                content = '<span style="font-size:1.5em;">ğŸ¦Š</span>';
                extraStyle = 'background:#ffe082;';
            } else if (hunterHere) {
                content = '<span style="font-size:1.5em;">ğŸ¯</span>';
                extraStyle = 'background:#b3e5fc;';
            } else {
                content = '';
                extraStyle = `background:${baseBg};`;
            }
        }
        holeIcons.push(`<div class="${style}" style="${extraStyle}"><div style="height:1.2em;"></div><div style="display:flex;align-items:center;justify-content:center;height:1.5em;">${content}</div></div>`);
    }
    document.getElementById('visual').innerHTML = numRow + `<div class='holes-row' style='margin-bottom:6px;text-align:center;'>${holeIcons.join('')}</div>`;
}

    // æ¨¡æ“¬å‡½å¼ï¼šåŸ·è¡Œä¸€æ¬¡éŠæˆ²æµç¨‹ï¼Œä¸¦å›å‚³æ¯ä¸€æ­¥ç‹€æ…‹
    function runVisual(foxStartPosition, hunterStrategy) {
        const fox = new Fox(foxStartPosition);
        const hunter = new Hunter(hunterStrategy);
        const steps = [];
        for (let day = 1; day <= hunterStrategy.length; day++) {
            const checkHole = hunter.getCheck(day);
            steps.push({
                type: 'day',
                day,
                fox: fox.currentPosition,
                hunter: checkHole,
                caught: checkHole === fox.currentPosition
            });
            if (checkHole === fox.currentPosition) break;
            if (day < hunterStrategy.length) {
                fox.move();
                steps.push({
                    type: 'night',
                    day,
                    fox: fox.currentPosition,
                    hunter: null,
                    caught: false
                });
            }
        }
        return steps;
    }

    // å•Ÿå‹•æ¨¡æ“¬ä¸»æµç¨‹ï¼ˆå«åœ–åƒåŒ–ï¼‰

let simState = { start: 1, hunterStrategy: [2, 3, 4, 4, 3, 2], steps: [], stepIdx: 0, running: false };

async function startSimulation() {
    simState = { start: 1, hunterStrategy: [2, 3, 4, 4, 3, 2], steps: [], stepIdx: 0, running: true };
    const visualDiv = document.getElementById('visual');
    const descDiv = document.getElementById('desc');
    const simBtn = document.getElementById('simBtn');
    const catchBtn = document.getElementById('catchBtn');
    visualDiv.innerHTML = '';
    descDiv.textContent = '';
    simBtn.textContent = 'æ¨¡æ“¬ä¸­...';
    catchBtn.textContent = 'æŠ“ç‹ç‹¸éŠæˆ²';
    // éš±è—é¸æ´æŒ‰éˆ•
    document.getElementById('catchControls').style.display = 'none';
    document.getElementById('catchControls').innerHTML = '';
    await runOneSimulation();
    simBtn.textContent = 'æ¨¡æ“¬æ¨¡å¼';
    catchBtn.textContent = 'æŠ“ç‹ç‹¸éŠæˆ²';
}

// æŠ“ç‹ç‹¸æ¨¡å¼ç‹€æ…‹
let catchState = null;
function startCatchMode() {
    // ç‹ç‹¸éš¨æ©Ÿé¸ä¸€å€‹æ´
    catchState = {
        fox: new Fox(Math.floor(Math.random()*5)+1),
        hunterPos: null,
        day: 1,
        running: true,
        msg: ''
    };
    document.getElementById('desc').textContent = 'è«‹é¸æ“‡è¦æª¢æŸ¥çš„æ´å£ï¼ˆ1~5ï¼‰ï¼š';
    document.getElementById('simBtn').textContent = 'æ¨¡æ“¬æ¨¡å¼';
    document.getElementById('catchBtn').textContent = 'æŠ“ç‹ç‹¸éŠæˆ²';
    drawCatchHoles();
    showCatchControls();
}
// ä¸å†éœ€è¦ showCatchStartSelector
// ä¸å†éœ€è¦ catchStart
function drawCatchHoles() {
    // é¡¯ç¤ºçµäººèˆ‡ç‹ç‹¸ï¼Œè‹¥æŠ“åˆ°å‰‡é¡¯ç¤ºğŸ’¥
    let numRow = '<div class="holes-num-row" style="display:flex;justify-content:center;gap:2vw;margin-bottom:2px;">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div style="width:14vw;max-width:56px;min-width:36px;text-align:center;font-size:1em;color:#888;">${i}</div>`;
    }
    numRow += '</div>';
    const holeIcons = [];
    let caught = catchState && !catchState.running && catchState.hunterPos === catchState.fox.currentPosition;
    for (let i = 1; i <= 5; i++) {
        let style = 'hole';
        let extraStyle = '';
        let hunterHere = i === catchState.hunterPos;
        let foxHere = i === catchState.fox.currentPosition;
        let content = '';
        let baseBg = '#fff';
        if (hunterHere && foxHere && caught) {
            content = '<span style="font-size:1.5em;">ğŸ’¥</span>';
            extraStyle = 'background:#ffecb3;border:2px solid #e65100;';
        } else if (hunterHere) {
            content = '<span style="font-size:1.5em;">ğŸ¯</span>';
            extraStyle = 'background:#b3e5fc;';
        } else {
            content = '';
            extraStyle = `background:${baseBg};`;
        }
        holeIcons.push(`<div class="${style}" style="${extraStyle}"><div style="height:1.2em;"></div><div style="display:flex;align-items:center;justify-content:center;height:1.5em;">${content}</div></div>`);
    }
    document.getElementById('visual').innerHTML = numRow + `<div class='holes-row' style='margin-bottom:6px;text-align:center;'>${holeIcons.join('')}</div>`;
}
function showCatchControls() {
    const controls = document.getElementById('catchControls');
    controls.style.display = 'flex';
    controls.innerHTML = '';
    // é¡¯ç¤º1~5æ•¸å­—æŒ‰éˆ•
    for (let i = 1; i <= 5; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.style.minWidth = '2.5em';
        btn.onclick = () => checkHole(i);
        controls.appendChild(btn);
    }
}


function checkHole(holeNum) {
    if (!catchState.running) return;
    catchState.hunterPos = holeNum;
    // ç¦ç”¨æ‰€æœ‰æ´å£æŒ‰éˆ•
    const controls = document.getElementById('catchControls');
    Array.from(controls.querySelectorAll('button')).forEach(btn => btn.disabled = true);
    // ç™½å¤©æª¢æŸ¥
    if (catchState.hunterPos === catchState.fox.currentPosition) {
        catchState.running = false;
        drawCatchHolesCaught();
        document.getElementById('desc').textContent = `æ­å–œï¼ä½ åœ¨ç¬¬${catchState.day}å¤©æ–¼æ´å£${catchState.hunterPos}æŠ“åˆ°ç‹ç‹¸ï¼`;
        document.getElementById('catchControls').innerHTML = '<button onclick="resetAll()">å†ç©ä¸€æ¬¡</button>';
    } else {
        document.getElementById('desc').textContent = `ç¬¬${catchState.day}å¤©ï¼Œæ²’æŠ“åˆ°ï¼Œå¤œæ™šç‹ç‹¸ç§»å‹•...`;
        drawCatchHoles();
        setTimeout(()=>{
            catchState.fox.move();
            catchState.day++;
            document.getElementById('desc').textContent = `ç¬¬${catchState.day}å¤©ï¼Œè«‹é¸æ“‡è¦æª¢æŸ¥çš„æ´å£ã€‚`;
            drawCatchHoles();
            // æ›æ—¥å¾Œæ¢å¾©æŒ‰éˆ•å¯ç”¨
            Array.from(controls.querySelectorAll('button')).forEach(btn => btn.disabled = false);
        }, 700);
    }
}

function drawCatchHolesCaught() {
    // é¡¯ç¤ºæŠ“åˆ°åœ–ç¤º
    let numRow = '<div class="holes-num-row" style="display:flex;justify-content:center;gap:2vw;margin-bottom:2px;">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div style="width:14vw;max-width:56px;min-width:36px;text-align:center;font-size:1em;color:#888;">${i}</div>`;
    }
    numRow += '</div>';
    const holeIcons = [];
    for (let i = 1; i <= 5; i++) {
        let style = 'hole';
        let extraStyle = '';
        let hunterHere = i === catchState.hunterPos;
        let content = '';
        let baseBg = '#fff';
        if (hunterHere) {
            content = '<span style="font-size:1.5em;">ğŸ’¥</span>';
            extraStyle = 'background:#ffecb3;border:2px solid #e65100;';
        } else {
            content = '';
            extraStyle = `background:${baseBg};`;
        }
        holeIcons.push(`<div class="${style}" style="${extraStyle}"><div style="height:1.2em;"></div><div style="display:flex;align-items:center;justify-content:center;height:1.5em;">${content}</div></div>`);
    }
    document.getElementById('visual').innerHTML = numRow + `<div class='holes-row' style='margin-bottom:6px;text-align:center;'>${holeIcons.join('')}</div>`;
}
function resetAll() {
    document.getElementById('catchControls').style.display = 'none';
    document.getElementById('catchControls').innerHTML = '';
    document.getElementById('desc').textContent = '';
    document.getElementById('visual').innerHTML = '';
    // ç›´æ¥é‡æ–°é–‹å§‹æŠ“ç‹ç‹¸éŠæˆ²
    startCatchMode();
}
async function runOneSimulation() {
    const { start, hunterStrategy } = simState;
    const visualDiv = document.getElementById('visual');
    const descDiv = document.getElementById('desc');
    descDiv.textContent = '';
    visualDiv.innerHTML = '';
    simState.steps = runVisual(simState.start, hunterStrategy);
    simState.stepIdx = 0;
    for (let i = 0; i < simState.steps.length; i++) {
        simState.stepIdx = i;
        const s = simState.steps[i];
        // å‚³å…¥ caught åƒæ•¸ï¼Œåªæœ‰æŠ“åˆ°æ™‚æ‰ç‚º true
        drawHoles(s.fox, s.hunter, s.day, s.type === 'night', s.caught);
        // æ–‡å­—èªªæ˜
        let msg = '';
        if (s.type === 'day') {
            msg = `ç¬¬${s.day}å¤©ï¼šçµäººæª¢æŸ¥æ´å£${s.hunter}ï¼Œç‹ç‹¸åœ¨æ´å£${s.fox}ã€‚`;
            if (s.caught) msg += `\nåœ¨ç¬¬${s.day}å¤©æ–¼æ´å£${s.fox}æŠ“åˆ°ç‹ç‹¸ï¼æˆåŠŸï¼`;
        } else {
            msg = `å¤œæ™š${s.day}ï¼šç‹ç‹¸ç§»å‹•åˆ°æ´å£${s.fox}ã€‚`;
        }
        descDiv.textContent = msg;
        if (s.caught) {
            await new Promise(r => setTimeout(r, 700));
            descDiv.textContent += '\næ¨¡æ“¬çµæŸ';
            return;
        }
        await new Promise(r => setTimeout(r, 700));
    }
    descDiv.textContent += '\næ¨¡æ“¬çµæŸ';
}
    </script>
</body>
</html>