<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹ç‹¸èˆ‡çµäºº</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* å°å…¥å­—é«” */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        html, body { 
            height: 100%; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0; 
            padding: 0 0 2em 0; 
            min-height: 100vh;
            position: relative;
        }
        
        /* èƒŒæ™¯å‹•ç•«ç²’å­æ•ˆæœ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="60" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2em 2vw;
            position: relative;
            z-index: 1;
        }
        
        h2 { 
            font-size: 2.5em; 
            margin: 0.5em 0 1em 0; 
            text-align: center; 
            letter-spacing: 2px; 
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            font-weight: 700;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* æŒ‰éˆ•æ¨£å¼å„ªåŒ– */
        button { 
            font-size: 1.2em; 
            font-weight: 500;
            padding: 0.8em 2em; 
            margin: 0.5em; 
            border-radius: 25px; 
            border: none; 
            background: linear-gradient(45deg, #ff6b9d, #c44569);
            color: #fff; 
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.6);
        }
        
        button:active { 
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(255, 107, 157, 0.4);
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 1em;
            margin-bottom: 2em;
            flex-wrap: wrap;
        }
        
        #visual { 
            margin-bottom: 2.5em; 
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5em;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        #desc { 
            background: rgba(255,255,255,0.95);
            color: #333; 
            padding: 1.2em 1.5em; 
            margin: 2em auto 1em auto; 
            border-radius: 15px; 
            min-height: 3em; 
            font-size: 1.1em; 
            border: none;
            max-width: 500px; 
            box-sizing: border-box; 
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            line-height: 1.6;
            font-weight: 400;
        }
        
        .holes-row { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 1.5em; 
            margin: 1em 0;
        }
        
        .holes-num-row {
            display: flex;
            justify-content: center;
            gap: 1.5em;
            margin-bottom: 0.5em;
        }
        
        .holes-num-row > div {
            width: 60px !important;
            max-width: 60px !important;
            min-width: 60px !important;
            text-align: center;
            font-size: 1.1em !important;
            color: rgba(255,255,255,0.8) !important;
            font-weight: 500;
        }
        
        .hole { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            width: 60px;
            height: 60px;
            margin: 2px; 
            text-align: center; 
            font-size: 2.2em; 
            border-radius: 50%; 
            border: 3px solid rgba(255,255,255,0.3);
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            box-sizing: border-box; 
            transition: all 0.4s ease;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
        }
        
        .hole::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .hole:hover::before {
            opacity: 1;
            animation: shimmer 1s ease-in-out;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        /* ç‰¹æ®Šç‹€æ…‹æ¨£å¼ */
        .hole.fox-hole {
            background: linear-gradient(145deg, #ffe082, #ffcc02) !important;
            border-color: #ff8f00 !important;
            box-shadow: 
                0 6px 20px rgba(255, 193, 7, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.8) !important;
            animation: foxGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes foxGlow {
            0% { box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4), inset 0 1px 0 rgba(255,255,255,0.8); }
            100% { box-shadow: 0 8px 25px rgba(255, 193, 7, 0.6), inset 0 1px 0 rgba(255,255,255,0.8); }
        }
        
        .hole.hunter-hole {
            background: linear-gradient(145deg, #b3e5fc, #81d4fa) !important;
            border-color: #0288d1 !important;
            box-shadow: 
                0 6px 20px rgba(3, 169, 244, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.8) !important;
        }
        
        .hole.caught-hole {
            background: linear-gradient(145deg, #ffecb3, #ffe082) !important;
            border-color: #e65100 !important;
            box-shadow: 
                0 8px 25px rgba(230, 81, 0, 0.5),
                inset 0 1px 0 rgba(255,255,255,0.8) !important;
            animation: caughtPulse 0.5s ease-in-out 3;
        }
        
        @keyframes caughtPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 900px) {
            .container { max-width: 98vw; padding: 1.5em 2vw; }
            h2 { font-size: 2em; }
            #desc { font-size: 1em; }
            .hole { width: 50px; height: 50px; font-size: 1.8em; }
            .holes-num-row > div { width: 50px !important; max-width: 50px !important; min-width: 50px !important; }
        }
        
        @media (max-width: 600px) {
            .container { max-width: 100vw; padding: 1em 1vw; }
            h2 { font-size: 1.6em; }
            #desc { font-size: 0.95em; padding: 1em; margin-top: 1.5em; }
            .hole { width: 45px; height: 45px; font-size: 1.6em; }
            .holes-num-row > div { width: 45px !important; max-width: 45px !important; min-width: 45px !important; }
            .holes-row { gap: 1em; }
            .holes-num-row { gap: 1em; }
            button { font-size: 1em; padding: 0.7em 1.5em; }
        }
        
        @media (max-width: 400px) {
            .hole { width: 40px; height: 40px; font-size: 1.4em; }
            .holes-num-row > div { width: 40px !important; max-width: 40px !important; min-width: 40px !important; }
        }
        
        button:disabled {
            background: linear-gradient(45deg, #ccc, #999) !important;
            color: #666 !important;
            cursor: not-allowed !important;
            opacity: 0.6;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* æ§åˆ¶æŒ‰éˆ•æ¨£å¼ */
        #catchControls {
            display: none;
            justify-content: center;
            gap: 0.8em;
            margin-top: 1.5em;
            flex-wrap: wrap;
        }
        
        #catchControls button {
            min-width: 3em;
            padding: 0.6em 1em;
            font-size: 1.1em;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            margin: 0.2em;
        }
        
        #catchControls button:hover {
            background: linear-gradient(45deg, #45a049, #3d8b40);
        }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* æˆåŠŸå‹•ç•« */
        @keyframes successBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .success-animation {
            animation: successBounce 1s ease-in-out;
        }
        
        /* å½ˆæ¡†æ¨£å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 2em;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideIn 0.4s ease-out;
            margin: 1em;
        }
        
        @keyframes slideIn {
            from { 
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 1.5em;
        }
        
        .modal-title {
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b9d, #4285f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5em;
        }
        
        .modal-subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .modal-body {
            color: #333;
            line-height: 1.8;
            font-size: 1em;
        }
        
        .modal-footer {
            text-align: center;
            margin-top: 2em;
            padding-top: 1.5em;
            border-top: 1px solid #eee;
        }
        
        .modal-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 1em 3em;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }
        
        /* éŸ¿æ‡‰å¼å½ˆæ¡† */
        @media (max-width: 600px) {
            .modal-content {
                margin: 0.5em;
                padding: 1.5em;
                max-height: 90vh;
            }
            
            .modal-title {
                font-size: 1.6em;
            }
            
            .modal-body {
                font-size: 0.95em;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>ğŸ¦Š ç‹ç‹¸èˆ‡çµäºº ğŸ¯</h2>
        <div class="button-container">
            <button id="simBtn" onclick="startSimulation()">
                <i class="fas fa-play"></i> æ¨¡æ“¬æ¨¡å¼
            </button>
            <button id="catchBtn" onclick="startCatchMode()">
                <i class="fas fa-crosshairs"></i> æŠ“ç‹ç‹¸éŠæˆ²
            </button>
        </div>
        <div id="visual"></div>
        <div id="desc">
            <h3 style="text-align: center; color: #ff6b9d; margin-bottom: 1em; font-size: 1.2em;">
                <i class="fas fa-book-open"></i> éŠæˆ²è¦å‰‡
            </h3>
            <div style="text-align: left; font-size: 0.95em;">
                <p><strong>ğŸ¯ ç›®æ¨™ï¼š</strong>æŠ“ä½è—åœ¨5å€‹æ´ç©´ä¸­çš„ç‹ç‹¸</p>
                <p><strong>ğŸ¦Š ç‹ç‹¸è¦å‰‡ï¼š</strong>æ¯æ™šå¿…é ˆç§»å‹•åˆ°ç›¸é„°æ´ç©´ï¼Œä¸èƒ½åœç•™åŸåœ°</p>
                <p><strong>ğŸ¯ çµäººè¦å‰‡ï¼š</strong>æ¯å¤©åªèƒ½æª¢æŸ¥ä¸€å€‹æ´ç©´</p>
                <p><strong>ğŸ§  æŒ‘æˆ°ï¼š</strong>è¨­è¨ˆç­–ç•¥ä¿è­‰èƒ½æŠ“åˆ°ç‹ç‹¸ï¼</p>
                <div style="text-align: center; margin-top: 1.5em; padding-top: 1em; border-top: 1px solid #eee;">
                    <em style="color: #666;">é¸æ“‡æ¨¡å¼é–‹å§‹éŠæˆ² â†‘</em>
                </div>
            </div>
        </div>
        <div id="catchControls"></div>
    </div>


    <script>

    // ç‹ç‹¸é¡åˆ¥ï¼šè² è²¬ç‹ç‹¸çš„ä½ç½®èˆ‡ç§»å‹•
    class Fox {
        constructor(startingPosition) {
            this.currentPosition = startingPosition; // ç‹ç‹¸ç›®å‰æ‰€åœ¨æ´å£
        }

        // ç‹ç‹¸æ¯æ™šå¿…é ˆç§»å‹•åˆ°ç›¸é„°çš„æ´å£
        move() {
            const pos = this.currentPosition;
            let options = [];
            if (pos === 1) {
                options = [2]; // æ´1åªèƒ½ç§»åˆ°æ´2
            } else if (pos === 5) {
                options = [4]; // æ´5åªèƒ½ç§»åˆ°æ´4
            } else {
                options = [pos - 1, pos + 1]; // å…¶ä»–æ´å¯å¾€å·¦æˆ–å³
            }
            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹å¯ç§»å‹•çš„æ´å£
            this.currentPosition = options[Math.floor(Math.random() * options.length)];
        }
    }

    // çµäººé¡åˆ¥ï¼šè² è²¬çµäººçš„æŸ¥æ‰¾ç­–ç•¥
    class Hunter {
        constructor(strategy) {
            this.strategy = strategy; // æŸ¥æ‰¾æ´å£çš„é †åºé™£åˆ—
        }

        // å›å‚³æŒ‡å®šå¤©æ•¸è¦æŸ¥çš„æ´å£ï¼ˆ1-basedï¼‰
        getCheck(day) {
            return this.strategy[day - 1];
        }
    }

    // ç•«å‡ºç•¶å‰æ´å£ç‹€æ…‹

function drawHoles(foxPos, hunterPos, day, isNight, caught) {
    // å…ˆç”¢ç”Ÿæ•¸å­—åˆ—
    let numRow = '<div class="holes-num-row">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div>${i}</div>`;
    }
    numRow += '</div>';
    
    // æ´å£åœ–ç¤º
    const holeIcons = [];
    for (let i = 1; i <= 5; i++) {
        let classes = ['hole'];
        let foxHere = i === foxPos;
        let hunterHere = i === hunterPos && !isNight;
        let content = '';
        
        // æ ¹æ“šç‹€æ…‹æ·»åŠ CSSé¡åˆ¥
        if (foxHere && hunterHere && caught) {
            classes.push('caught-hole');
            content = '<span style="font-size:1.8em;">ğŸ’¥</span>';
        } else if (foxHere && hunterHere) {
            classes.push('fox-hole');
            content = '<div style="display:flex;align-items:center;justify-content:center;gap:2px;"><span style="font-size:1.2em;">ğŸ¦Š</span><span style="font-size:1.2em;">ğŸ¯</span></div>';
        } else if (foxHere) {
            classes.push('fox-hole');
            content = '<span style="font-size:1.6em;">ğŸ¦Š</span>';
        } else if (hunterHere) {
            classes.push('hunter-hole');
            content = '<span style="font-size:1.6em;">ğŸ¯</span>';
        } else {
            content = isNight ? '<i class="fas fa-moon" style="font-size:0.8em;color:#666;"></i>' : '';
        }
        
        holeIcons.push(`<div class="${classes.join(' ')}">${content}</div>`);
    }
    
    const timeIndicator = isNight ? 
        '<div style="text-align:center;margin-bottom:1em;color:rgba(255,255,255,0.9);font-size:1.1em;"><i class="fas fa-moon"></i> å¤œæ™š</div>' : 
        '<div style="text-align:center;margin-bottom:1em;color:rgba(255,255,255,0.9);font-size:1.1em;"><i class="fas fa-sun"></i> ç™½å¤©</div>';
    
    document.getElementById('visual').innerHTML = timeIndicator + numRow + `<div class='holes-row'>${holeIcons.join('')}</div>`;
}

    // æ¨¡æ“¬å‡½å¼ï¼šåŸ·è¡Œä¸€æ¬¡éŠæˆ²æµç¨‹ï¼Œä¸¦å›å‚³æ¯ä¸€æ­¥ç‹€æ…‹
    function runVisual(foxStartPosition, hunterStrategy) {
        const fox = new Fox(foxStartPosition);
        const hunter = new Hunter(hunterStrategy);
        const steps = [];
        for (let day = 1; day <= hunterStrategy.length; day++) {
            const checkHole = hunter.getCheck(day);
            steps.push({
                type: 'day',
                day,
                fox: fox.currentPosition,
                hunter: checkHole,
                caught: checkHole === fox.currentPosition
            });
            if (checkHole === fox.currentPosition) break;
            if (day < hunterStrategy.length) {
                fox.move();
                steps.push({
                    type: 'night',
                    day,
                    fox: fox.currentPosition,
                    hunter: null,
                    caught: false
                });
            }
        }
        return steps;
    }

    // å•Ÿå‹•æ¨¡æ“¬ä¸»æµç¨‹ï¼ˆå«åœ–åƒåŒ–ï¼‰

let simState = { start: 1, hunterStrategy: [2, 3, 4, 4, 3, 2], steps: [], stepIdx: 0, running: false };

async function startSimulation() {
    simState = { start: 1, hunterStrategy: [2, 3, 4, 4, 3, 2], steps: [], stepIdx: 0, running: true };
    const visualDiv = document.getElementById('visual');
    const descDiv = document.getElementById('desc');
    const simBtn = document.getElementById('simBtn');
    const catchBtn = document.getElementById('catchBtn');
    
    visualDiv.innerHTML = '';
    descDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æº–å‚™æ¨¡æ“¬...';
    simBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ¨¡æ“¬ä¸­...';
    simBtn.disabled = true;
    catchBtn.innerHTML = '<i class="fas fa-crosshairs"></i> æŠ“ç‹ç‹¸éŠæˆ²';
    
    // éš±è—é¸æ´æŒ‰éˆ•
    document.getElementById('catchControls').style.display = 'none';
    document.getElementById('catchControls').innerHTML = '';
    
    await runOneSimulation();
    
    simBtn.innerHTML = '<i class="fas fa-play"></i> æ¨¡æ“¬æ¨¡å¼';
    simBtn.disabled = false;
    catchBtn.innerHTML = '<i class="fas fa-crosshairs"></i> æŠ“ç‹ç‹¸éŠæˆ²';
}

// æŠ“ç‹ç‹¸æ¨¡å¼ç‹€æ…‹
let catchState = null;
function startCatchMode() {
    // ç‹ç‹¸éš¨æ©Ÿé¸ä¸€å€‹æ´
    catchState = {
        fox: new Fox(Math.floor(Math.random()*5)+1),
        hunterPos: null,
        day: 1,
        running: true,
        msg: ''
    };
    document.getElementById('desc').innerHTML = '<i class="fas fa-search"></i> è«‹é¸æ“‡è¦æª¢æŸ¥çš„æ´å£ï¼ˆ1~5ï¼‰ï¼š';
    document.getElementById('simBtn').innerHTML = '<i class="fas fa-play"></i> æ¨¡æ“¬æ¨¡å¼';
    document.getElementById('catchBtn').innerHTML = '<i class="fas fa-crosshairs"></i> æŠ“ç‹ç‹¸éŠæˆ²';
    drawCatchHoles();
    showCatchControls();
}
// ä¸å†éœ€è¦ showCatchStartSelector
// ä¸å†éœ€è¦ catchStart
function drawCatchHoles() {
    // é¡¯ç¤ºçµäººèˆ‡ç‹ç‹¸ï¼Œè‹¥æŠ“åˆ°å‰‡é¡¯ç¤ºğŸ’¥
    let numRow = '<div class="holes-num-row">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div>${i}</div>`;
    }
    numRow += '</div>';
    
    const holeIcons = [];
    let caught = catchState && !catchState.running && catchState.hunterPos === catchState.fox.currentPosition;
    
    for (let i = 1; i <= 5; i++) {
        let classes = ['hole'];
        let hunterHere = i === catchState.hunterPos;
        let foxHere = i === catchState.fox.currentPosition;
        let content = '';
        
        if (hunterHere && foxHere && caught) {
            classes.push('caught-hole');
            content = '<span style="font-size:1.8em;">ğŸ’¥</span>';
        } else if (hunterHere) {
            classes.push('hunter-hole');
            content = '<span style="font-size:1.6em;">ğŸ¯</span>';
        } else {
            content = '';
        }
        
        holeIcons.push(`<div class="${classes.join(' ')}">${content}</div>`);
    }
    
    const dayIndicator = `<div style="text-align:center;margin-bottom:1em;color:rgba(255,255,255,0.9);font-size:1.1em;"><i class="fas fa-calendar-day"></i> ç¬¬ ${catchState.day} å¤©</div>`;
    document.getElementById('visual').innerHTML = dayIndicator + numRow + `<div class='holes-row'>${holeIcons.join('')}</div>`;
}
function showCatchControls() {
    const controls = document.getElementById('catchControls');
    controls.style.display = 'flex';
    controls.innerHTML = '';
    // é¡¯ç¤º1~5æ•¸å­—æŒ‰éˆ•
    for (let i = 1; i <= 5; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.style.minWidth = '2.5em';
        btn.onclick = () => checkHole(i);
        controls.appendChild(btn);
    }
}


function checkHole(holeNum) {
    if (!catchState.running) return;
    catchState.hunterPos = holeNum;
    // ç¦ç”¨æ‰€æœ‰æ´å£æŒ‰éˆ•
    const controls = document.getElementById('catchControls');
    Array.from(controls.querySelectorAll('button')).forEach(btn => btn.disabled = true);
    // ç™½å¤©æª¢æŸ¥
    if (catchState.hunterPos === catchState.fox.currentPosition) {
        catchState.running = false;
        drawCatchHolesCaught();
        document.getElementById('desc').innerHTML = `<i class="fas fa-trophy"></i> æ­å–œï¼ä½ åœ¨ç¬¬${catchState.day}å¤©æ–¼æ´å£${catchState.hunterPos}æŠ“åˆ°ç‹ç‹¸ï¼`;
        document.getElementById('catchControls').innerHTML = '<button onclick="resetAll()"><i class="fas fa-redo"></i> å†ç©ä¸€æ¬¡</button>';
    } else {
        document.getElementById('desc').innerHTML = `<i class="fas fa-times"></i> ç¬¬${catchState.day}å¤©ï¼Œæ²’æŠ“åˆ°ï¼Œå¤œæ™šç‹ç‹¸ç§»å‹•...`;
        drawCatchHoles();
        setTimeout(()=>{
            catchState.fox.move();
            catchState.day++;
            document.getElementById('desc').innerHTML = `<i class="fas fa-search"></i> ç¬¬${catchState.day}å¤©ï¼Œè«‹é¸æ“‡è¦æª¢æŸ¥çš„æ´å£ã€‚`;
            drawCatchHoles();
            // æ›æ—¥å¾Œæ¢å¾©æŒ‰éˆ•å¯ç”¨
            Array.from(controls.querySelectorAll('button')).forEach(btn => btn.disabled = false);
        }, 700);
    }
}

function drawCatchHolesCaught() {
    // é¡¯ç¤ºæŠ“åˆ°åœ–ç¤º
    let numRow = '<div class="holes-num-row">';
    for (let i = 1; i <= 5; i++) {
        numRow += `<div>${i}</div>`;
    }
    numRow += '</div>';
    
    const holeIcons = [];
    for (let i = 1; i <= 5; i++) {
        let classes = ['hole'];
        let hunterHere = i === catchState.hunterPos;
        let content = '';
        
        if (hunterHere) {
            classes.push('caught-hole', 'success-animation');
            content = '<span style="font-size:1.8em;">ğŸ’¥</span>';
        } else {
            content = '';
        }
        
        holeIcons.push(`<div class="${classes.join(' ')}">${content}</div>`);
    }
    
    const successIndicator = `<div style="text-align:center;margin-bottom:1em;color:#4CAF50;font-size:1.2em;font-weight:bold;"><i class="fas fa-trophy"></i> æˆåŠŸæŠ“åˆ°ç‹ç‹¸ï¼</div>`;
    document.getElementById('visual').innerHTML = successIndicator + numRow + `<div class='holes-row'>${holeIcons.join('')}</div>`;
}
function resetAll() {
    document.getElementById('catchControls').style.display = 'none';
    document.getElementById('catchControls').innerHTML = '';
    document.getElementById('desc').textContent = '';
    document.getElementById('visual').innerHTML = '';
    // ç›´æ¥é‡æ–°é–‹å§‹æŠ“ç‹ç‹¸éŠæˆ²
    startCatchMode();
}
async function runOneSimulation() {
    const { start, hunterStrategy } = simState;
    const visualDiv = document.getElementById('visual');
    const descDiv = document.getElementById('desc');
    descDiv.textContent = '';
    visualDiv.innerHTML = '';
    simState.steps = runVisual(simState.start, hunterStrategy);
    simState.stepIdx = 0;
    for (let i = 0; i < simState.steps.length; i++) {
        simState.stepIdx = i;
        const s = simState.steps[i];
        // å‚³å…¥ caught åƒæ•¸ï¼Œåªæœ‰æŠ“åˆ°æ™‚æ‰ç‚º true
        drawHoles(s.fox, s.hunter, s.day, s.type === 'night', s.caught);
        // æ–‡å­—èªªæ˜
        let msg = '';
        if (s.type === 'day') {
            msg = `ç¬¬${s.day}å¤©ï¼šçµäººæª¢æŸ¥æ´å£${s.hunter}ï¼Œç‹ç‹¸åœ¨æ´å£${s.fox}ã€‚`;
            if (s.caught) msg += `\nåœ¨ç¬¬${s.day}å¤©æ–¼æ´å£${s.fox}æŠ“åˆ°ç‹ç‹¸ï¼æˆåŠŸï¼`;
        } else {
            msg = `å¤œæ™š${s.day}ï¼šç‹ç‹¸ç§»å‹•åˆ°æ´å£${s.fox}ã€‚`;
        }
        descDiv.textContent = msg;
        if (s.caught) {
            await new Promise(r => setTimeout(r, 700));
            descDiv.textContent += '\næ¨¡æ“¬çµæŸ';
            return;
        }
        await new Promise(r => setTimeout(r, 700));
    }
    descDiv.textContent += '\næ¨¡æ“¬çµæŸ';
}
    </script>
</body>
</html>